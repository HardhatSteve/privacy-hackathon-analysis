import{j as e}from"./index-HKquI-t2.js";import{r as d,P as Ne,S as ye,C as Se,a as ke,b as Ce,u as Pe}from"./wallet-adapters-BrkyT213.js";import{r as Q,d as B,s as ee}from"./privacyUtils-p52_K7k3.js";import{e as re,P as T,f as te,S as Re,T as ie,h as le,i as se,j as Ae,k as Le}from"./solana-core-C4IjULEX.js";import{e as Me}from"./cryptoNote-CBMOi0Hg.js";import{W as Be,a as Te}from"./wallet-ui-CFNU3nNx.js";function $e(a){const m=a.trim().slice(-1).toLowerCase(),l={a:"US",b:"GB",c:"DE",d:"FR",e:"NG",f:"BR",g:"CA",h:"IN",i:"RU",j:"IR",k:"SY",l:"UA",m:"AR",n:"JP",o:"KR",p:"SG",q:"ES",r:"IT",s:"SE",t:"TR",u:"NL",v:"PL",w:"AE",x:"SA",y:"EG",z:"ZA"}[m]||"US",i=Math.max(1,a.length%10),n=["KP","IR","SY","CU","RU"];return{passed:!n.includes(l)&&i>=3,country:l,ageDays:i,reasons:[n.includes(l)?`Blocked jurisdiction: ${l}`:null,i<3?`Account age too new: ${i}d < 3d`:null].filter(Boolean)}}function Oe(){async function a(m,s="send"){return{...$e(m),mode:"mock"}}return{prescreen:a}}const De="https://nerti-w8e6l5-fast-mainnet.helius-rpc.com",Ee="https://api.devnet.solana.com",ne=1e9,oe=new T("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ie=[{symbol:"USDC",mint:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",decimals:6},{symbol:"USDT",mint:"Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB",decimals:6},{symbol:"BONK",mint:"DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263",decimals:5},{symbol:"JUP",mint:"JUPyiwrYJFskUPiHa7hkeR8VUtAeFoSYbKedZNsDvCN",decimals:6}];function Ue(){return new Date().toLocaleTimeString()}function ae(a,m){if(m<=1)return[a];const s=Array.from({length:m},()=>Math.random()+.5),l=s.reduce((n,o)=>n+o,0),i=s.map(n=>Math.floor(n/l*a));return i[i.length-1]+=a-i.reduce((n,o)=>n+o,0),i}async function Ke(a,m){var p,g,h,v;const s=new T(m),l=await a.getAccountInfo(s,"confirmed");if(!l)throw new Error("Mint not found");const n=l.owner.toBase58()===te.toBase58()?te:re,b=(v=(h=(g=(p=(await a.getParsedAccountInfo(s,"confirmed")).value)==null?void 0:p.data)==null?void 0:g.parsed)==null?void 0:h.info)==null?void 0:v.decimals;if(b==null)throw new Error("Could not read token decimals");return{programId:n,decimals:b,mintPk:s}}async function _e({from:a,to:m,lamports:s,connection:l,memoBytes:i}){const n=Re.transfer({fromPubkey:a,toPubkey:m,lamports:s}),o=new ie().add(n);i&&i.length&&o.add(new le({programId:oe,keys:[],data:i}));const{blockhash:b,lastValidBlockHeight:p}=await l.getLatestBlockhash("finalized");return o.recentBlockhash=b,o.lastValidBlockHeight=p,o.feePayer=a,o}async function Fe({from:a,to:m,mintPk:s,amountUnits:l,decimals:i,programId:n,connection:o,memoBytes:b}){const p=se(s,a,!1,n),g=se(s,m,!1,n),h=[];await o.getAccountInfo(g,"processed")||h.push(Ae(a,g,m,s,n)),h.push(Le(p,s,g,a,l,i,[],n)),b&&b.length&&h.push(new le({programId:oe,keys:[],data:b}));const N=new ie;h.forEach(O=>N.add(O));const{blockhash:$,lastValidBlockHeight:P}=await o.getLatestBlockhash("finalized");return N.recentBlockhash=$,N.lastValidBlockHeight=P,N.feePayer=a,N}function We({isDevnet:a,setIsDevnet:m}){var V,X;const{connection:s}=Ce(),{publicKey:l,sendTransaction:i,connected:n}=Pe(),[o,b]=d.useState("SOL"),[p,g]=d.useState(""),[h,v]=d.useState(null),[N,$]=d.useState(""),[P,O]=d.useState(""),[C,ce]=d.useState(3),[R,de]=d.useState(30),[y,me]=d.useState(!0),[A,he]=d.useState(""),[L,ue]=d.useState(!1),[D,xe]=d.useState(""),[E,W]=d.useState(!1),[G,w]=d.useState(""),{prescreen:pe}=Oe(),[I,z]=d.useState(!1),[c,be]=d.useState(null),[M,H]=d.useState(!1),q=async()=>{var t;if(l){H(!0);try{const r=await pe(l.toBase58(),"send");be(r),u(`Compliance (${r.mode}): ${r.passed?"PASS":"BLOCK"}`),!r.passed&&((t=r.reasons)!=null&&t.length)&&r.reasons.forEach(f=>u(`  - ${f}`))}catch(r){u(`Compliance error: ${r.message}`)}finally{H(!1)}}},[J,Y]=d.useState([]),u=t=>Y(r=>[`[${Ue()}] ${t}`,...r]),ge=()=>Y([]),we=t=>{g(t.mint),v({mintPk:new T(t.mint),decimals:t.decimals,programId:re}),u(`Selected ${t.symbol} (${t.decimals} decimals)`)},fe=async()=>{if(p.trim())try{w("");const t=await Ke(s,p.trim());v(t),u(`Mint loaded: ${t.decimals} decimals`)}catch(t){w(t.message||"Failed to load mint")}},je=async()=>{if(w(""),!n||!l){w("Connect wallet first.");return}let t;try{t=new T(N.trim())}catch{w("Destination address is invalid.");return}const r=Number(P);if(!Number.isFinite(r)||r<=0){w("Amount must be a positive number.");return}if(!Number.isInteger(Number(C))||C<1||C>25){w("Splits must be an integer between 1 and 25.");return}if(o==="SPL"&&!h){w("Load token mint first.");return}if(L&&D.trim().length<4){w("Passphrase must be at least 4 characters.");return}W(!0);try{const f=Number(C),Z=f>1?Math.floor(Number(R)*1e3/(f-1)):0;let U=null;if(A.trim().length>0){const S=new TextEncoder;U=L?S.encode(await Me(A.trim(),D.trim())):S.encode(A.trim())}if(o==="SOL"){const S=Math.floor(r*ne),k=ae(S,f);u(`Starting SOL private send: ${r} SOL â†’ ${k.length} split(s) over ~${R}s`),u(`Destination: ${t.toBase58()}`),y&&u("Privacy mode ON");for(let x=0;x<k.length;x++){if(x>0){const _=Q(120,650),F=Math.max(0,Z+_);y&&await B(s),await ee(F)}const j=await _e({from:l,to:t,lamports:k[x],connection:s,memoBytes:x===0?U:null});y&&await B(s);const K=await i(j,s,{skipPreflight:!1,preflightCommitment:"processed"});u(`Split ${x+1}/${k.length}: ${(k[x]/ne).toFixed(6)} SOL | ${K.slice(0,20)}...`)}}else{const S=10**h.decimals,k=Math.floor(r*S),x=ae(k,f);u(`Starting SPL private send: ${r} tokens â†’ ${x.length} split(s) over ~${R}s`),u(`Destination: ${t.toBase58()}`),y&&u("Privacy mode ON");for(let j=0;j<x.length;j++){if(j>0){const F=Q(120,650),ve=Math.max(0,Z+F);y&&await B(s),await ee(ve)}const K=await Fe({from:l,to:t,mintPk:h.mintPk,amountUnits:x[j],decimals:h.decimals,programId:h.programId,connection:s,memoBytes:j===0?U:null});y&&await B(s);const _=await i(K,s,{skipPreflight:!1,preflightCommitment:"processed"});u(`Split ${j+1}/${x.length}: ${(x[j]/S).toFixed(h.decimals)} tokens | ${_.slice(0,20)}...`)}}u("âœ… Done!")}catch(f){w(f.message||"Send failed."),u(`âŒ Error: ${f.message}`)}finally{W(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-slate-900 to-slate-950 text-white",children:e.jsxs("div",{className:"max-w-3xl mx-auto px-5 py-8",children:[e.jsx("div",{className:"mb-4",children:e.jsx("a",{href:"/",className:"text-white/70 hover:text-white text-sm",children:"â† Back to RentReclaim"})}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"ðŸ”’ Private Send"}),e.jsx("p",{className:"text-white/60 text-sm mb-4",children:"Send SOL or SPL tokens with split transfers, time jitter, and decoy reads"}),e.jsx("div",{className:"mb-6",children:e.jsx(Te,{})}),e.jsx("div",{className:"mb-6 p-4 rounded-xl bg-yellow-500/10 border border-yellow-500/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-yellow-400",children:"âš ï¸"}),e.jsx("span",{className:"text-sm text-yellow-200",children:"Test on devnet first"})]}),e.jsx("button",{onClick:()=>m(!a),className:`px-3 py-1.5 text-xs font-semibold rounded-lg transition ${a?"bg-yellow-500/20 text-yellow-400 border border-yellow-500/50":"bg-red-500/20 text-red-400 border border-red-500/50"}`,children:a?"ðŸ§ª Devnet":"ðŸ”´ Mainnet"})]})}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-6 border border-white/10 space-y-4",children:[e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Asset"}),e.jsxs("select",{className:"w-full rounded-lg bg-white/5 border border-white/10 p-3 outline-none focus:border-purple-500",value:o,onChange:t=>{b(t.target.value),v(null),g("")},children:[e.jsx("option",{value:"SOL",children:"SOL"}),e.jsx("option",{value:"SPL",children:"SPL Token"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Destination Address"}),e.jsx("input",{className:"w-full rounded-lg bg-white/5 border border-white/10 p-3 outline-none focus:border-purple-500",placeholder:"Enter Solana address",value:N,onChange:t=>$(t.target.value)})]})]}),o==="SPL"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:Ie.map(t=>e.jsx("button",{onClick:()=>we(t),className:`px-3 py-1.5 rounded-lg text-sm transition ${p===t.mint?"bg-purple-600":"bg-white/10 hover:bg-white/20"}`,children:t.symbol},t.symbol))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"flex-1 rounded-lg bg-white/5 border border-white/10 p-3 outline-none focus:border-purple-500",placeholder:"Or paste token mint address",value:p,onChange:t=>{g(t.target.value),v(null)}}),e.jsx("button",{onClick:fe,className:"px-4 rounded-lg bg-white/10 hover:bg-white/20 transition",children:"Load"})]}),h&&e.jsxs("p",{className:"text-xs text-emerald-400",children:["âœ“ Token loaded (",h.decimals," decimals)"]})]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm mb-1",children:["Amount ",o==="SOL"?"(SOL)":"(tokens)"]}),e.jsx("input",{className:"w-full rounded-lg bg-white/5 border border-white/10 p-3 outline-none focus:border-purple-500",type:"number",min:"0",step:"any",placeholder:"0.00",value:P,onChange:t=>O(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Splits"}),e.jsx("input",{className:"w-full rounded-lg bg-white/5 border border-white/10 p-3 outline-none focus:border-purple-500",type:"number",min:"1",max:"25",value:C,onChange:t=>ce(Number(t.target.value))})]})]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Window (seconds)"}),e.jsx("input",{className:"w-full rounded-lg bg-white/5 border border-white/10 p-3 outline-none focus:border-purple-500",type:"number",min:"0",max:"1800",value:R,onChange:t=>de(Number(t.target.value))})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-6 sm:mt-7",children:[e.jsx("input",{id:"privacy",type:"checkbox",checked:y,onChange:t=>me(t.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"privacy",className:"text-sm",children:"Privacy mode (decoy reads + jitter)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Optional note"}),e.jsx("textarea",{className:"w-full rounded-lg bg-white/5 border border-white/10 p-3 outline-none focus:border-purple-500",placeholder:"Visible on-chain unless encrypted",value:A,onChange:t=>he(t.target.value),rows:2}),e.jsxs("div",{className:"mt-4 bg-white/5 border border-white/10 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-sm text-white/80 flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"accent-emerald-500",checked:I,onChange:t=>z(t.target.checked)}),"ðŸ›¡ï¸ Compliance Mode (Range)"]}),e.jsx("button",{onClick:q,disabled:!n||M,className:"text-xs px-3 py-1 rounded bg-white/10 hover:bg-white/20 border border-white/10 disabled:opacity-50",children:M?"Checkingâ€¦":"Check Now"})]}),c&&e.jsxs("div",{className:"text-xs mt-2",children:[c.passed?e.jsxs("div",{className:"text-green-400",children:["âœ… Passed (",c.mode,") Â· ",c.country," Â· ",c.ageDays,"d old"]}):e.jsxs("div",{className:"text-red-400",children:["âŒ Blocked (",c.mode,")"]}),((V=c.reasons)==null?void 0:V.length)>0&&e.jsx("ul",{className:"list-disc ml-4 text-white/60 mt-1",children:c.reasons.map((t,r)=>e.jsx("li",{children:t},r))})]})]})]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{id:"encrypt",type:"checkbox",checked:L,onChange:t=>ue(t.target.checked),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"encrypt",className:"text-sm",children:"Encrypt note with passphrase"})]}),e.jsx("input",{className:"w-full rounded-lg bg-white/5 border border-white/10 p-3 outline-none focus:border-purple-500",type:"password",placeholder:"Passphrase",disabled:!L,value:D,onChange:t=>xe(t.target.value)})]}),G&&e.jsxs("div",{className:"text-red-300 text-sm bg-red-900/30 border border-red-500/30 rounded-lg p-3",children:["âŒ ",G]}),e.jsxs("div",{className:"mt-4 bg-white/5 border border-white/10 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-sm text-white/80 flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"accent-emerald-500",checked:I,onChange:t=>z(t.target.checked)}),"ðŸ›¡ï¸ Compliance Mode (Range)"]}),e.jsx("button",{onClick:q,disabled:!n||M,className:"text-xs px-3 py-1 rounded bg-white/10 hover:bg-white/20 border border-white/10 disabled:opacity-50",children:M?"Checkingâ€¦":"Check Now"})]}),c&&e.jsxs("div",{className:"text-xs mt-2",children:[c.passed?e.jsxs("div",{className:"text-green-400",children:["âœ… Passed (",c.mode,") Â· ",c.country," Â· ",c.ageDays,"d old"]}):e.jsxs("div",{className:"text-red-400",children:["âŒ Blocked (",c.mode,")"]}),((X=c.reasons)==null?void 0:X.length)>0&&e.jsx("ul",{className:"list-disc ml-4 text-white/60 mt-1",children:c.reasons.map((t,r)=>e.jsx("li",{children:t},r))})]})]}),e.jsx("button",{onClick:je,disabled:!n||E||I&&!(c!=null&&c.passed),className:`w-full py-3 rounded-lg font-semibold transition ${n&&!E?"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500":"bg-white/10 cursor-not-allowed"}`,children:n?E?"Sendingâ€¦":"ðŸ”’ Send Privately":"âš ï¸ Connect wallet"})]}),e.jsxs("div",{className:"mt-8 bg-white/5 rounded-xl p-6 border border-white/10",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"ðŸ›¡ï¸ How It Works"}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-4 text-sm text-white/70",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-white mb-1",children:"Split Transfers"}),e.jsx("p",{children:"Payment divided into randomized smaller amounts."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-white mb-1",children:"Time Jitter"}),e.jsx("p",{children:"Randomized intervals break timing patterns."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-white mb-1",children:"Decoy Reads"}),e.jsx("p",{children:"Random RPC queries mask your activity."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-white mb-1",children:"SPL Tokens"}),e.jsx("p",{children:"Send USDC, USDT, BONK, JUP privately."})]})]}),e.jsx("p",{className:"mt-4 text-xs text-white/40",children:"âš ï¸ Obfuscation only. Amounts/addresses visible on-chain."})]}),e.jsxs("div",{className:"mt-8 bg-white/5 rounded-xl p-6 border border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Activity Log"}),e.jsx("button",{className:"text-sm text-white/70 hover:text-white",onClick:ge,children:"clear"})]}),e.jsx("div",{className:"text-sm text-white/70 space-y-1 min-h-[72px] max-h-48 overflow-auto font-mono",children:J.length===0?e.jsx("div",{className:"text-white/40",children:"No activity yet."}):J.map((t,r)=>e.jsx("div",{className:"text-white/80",children:t},r))})]})]})})}function Ve(){const[a,m]=d.useState(()=>(localStorage.getItem("cluster")||"devnet")==="devnet"),s=n=>{localStorage.setItem("cluster",n?"devnet":"mainnet"),m(n)},l=d.useMemo(()=>[new Ne,new ye],[]),i=a?Ee:De;return e.jsx(Se,{endpoint:i,children:e.jsx(ke,{wallets:l,autoConnect:!0,children:e.jsx(Be,{children:e.jsx(We,{isDevnet:a,setIsDevnet:s})})})},i)}export{Ve as default};
