const d=new TextEncoder,p=new TextDecoder;function i(o){let e="";return o.forEach(t=>e+=String.fromCharCode(t)),btoa(e)}function y(o){const e=atob(o),t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}async function u(o,e,t=15e4){const n=await crypto.subtle.importKey("raw",d.encode(o),"PBKDF2",!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:e,iterations:t,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function l(o,e){const t=crypto.getRandomValues(new Uint8Array(16)),n=crypto.getRandomValues(new Uint8Array(12)),r=await u(e,t),c=await crypto.subtle.encrypt({name:"AES-GCM",iv:n},r,d.encode(o)),a=new Uint8Array(c),s={v:1,i:15e4,s:i(t),n:i(n),c:i(a)};return JSON.stringify(s)}async function f(o,e){const t=JSON.parse(o);if(t.v!==1)throw new Error("Unsupported note version");const n=y(t.s),r=y(t.n),c=y(t.c),a=await u(e,n,t.i||15e4),s=await crypto.subtle.decrypt({name:"AES-GCM",iv:r},a,c);return p.decode(s)}export{f as d,l as e};
